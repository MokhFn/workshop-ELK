input {
    file {
        path => "C:/tmp/access_log_*.log"
        start_position => beginning
		sincedb_path => "/dev/null"
    }
}
filter {
    grok {
        match => { "message" => "%{COMBINEDAPACHELOG}"}
    }
    date {
		match => ["timestamp", "dd/MMM/YYYY:HH:mm:ss Z"]
		target => "timestamp"
	}
    geoip {
        source => "clientip"
    }
  	kv {
  		source => "request"
    	field_split => "&?"
    	value_split => "="
    	target => "query_params"
  	}
    grok {
      match => { "request" => "%{URIPATH:api}" }
    }
    mutate {
        split => {"[query_params][q]" => "%20"}
    }
}
output {
	stdout { codec => rubydebug }
    elasticsearch {  hosts => [ "localhost:9200" ] }
}
